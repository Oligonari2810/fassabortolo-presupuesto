<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Presupuesto Interno - FassaBortolo Caribe</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; line-height: 1.6; }
        .header { background: white; padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
        .logo span { color: #e74c3c; }
        .main-container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .budget-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 15px; margin-bottom: 2rem; }
        .budget-header h1 { font-size: 2.2rem; margin-bottom: 1rem; }
        .project-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .info-card { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; }
        .budget-table { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 1rem; text-align: left; font-weight: 600; color: #2c3e50; border-bottom: 2px solid #dee2e6; }
        td { padding: 1rem; border-bottom: 1px solid #dee2e6; }
        tr:hover { background: #f8f9fa; }
        .system-name { font-weight: 600; color: #2c3e50; }
        .qty-input { width: 80px; padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 4px; text-align: center; }
        .total-row { background: #e74c3c; color: white; font-size: 1.3rem; font-weight: bold; }
        .actions-section { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; }
        .btn { padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; margin: 0.5rem; }
        .btn-success { background: #28a745; color: white; }
        .btn-primary { background: #2c3e50; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn:hover { transform: translateY(-2px); }
        .materials-breakdown { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-top: 1rem; border-left: 4px solid #28a745; }
        .materials-breakdown h3 { color: #2c3e50; margin-bottom: 1rem; }
        @media (max-width: 768px) { .project-info { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <div class="logo">Fassa<span>Bortolo</span> Caribe</div>
            <div style="font-weight:bold; color:#e74c3c;">üõ†Ô∏è MATERIALES POR SISTEMA</div>
        </nav>
    </header>

    <main class="main-container">
        <div class="budget-header">
            <h1><i class="fas fa-calculator"></i> Generador de Presupuesto de Materiales</h1>
            <div class="project-info">
                <div class="info-card">
                    <strong>Proyecto:</strong><br>
                    <input type="text" id="projectName" placeholder="Ej: Larimar Prime T4" style="width:100%; padding:0.5rem; margin-top:0.5rem; border-radius:4px; border:none;">
                </div>
                <div class="info-card">
                    <strong>Total m¬≤:</strong><br>
                    <span id="totalM2" style="font-size:1.5rem;">0</span> m¬≤
                </div>
                <div class="info-card">
                    <strong>Sistemas:</strong><br>
                    <span id="totalSistemas" style="font-size:1.5rem;">0</span> sistemas
                </div>
                <div class="info-card">
                    <strong>Estado:</strong><br>
                    <span style="color:#28a745;">Interno</span>
                </div>
            </div>
        </div>

        <div class="budget-table">
            <table>
                <thead>
                    <tr>
                        <th>Sistema</th>
                        <th>C√≥digo</th>
                        <th>m¬≤ Proyecto</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody id="budgetTableBody"></tbody>
            </table>
        </div>

        <div class="materials-breakdown" id="materialsBreakdown" style="display:none;">
            <h3><i class="fas fa-cogs"></i> Desglose Total de Materiales</h3>
            <table id="materialsTotalTable" style="width:100%; margin-top:1rem;">
                <thead>
                    <tr style="background:#dee2e6;">
                        <th>Material</th>
                        <th>Cantidad Total</th>
                        <th>Unidad</th>
                    </tr>
                </thead>
                <tbody id="materialsTotalBody"></tbody>
            </table>
        </div>

        <div class="actions-section">
            <button class="btn btn-success" onclick="exportMaterialsList()">
                <i class="fas fa-file-excel"></i> Exportar Lista de Materiales (Excel)
            </button>
            <button class="btn btn-primary" onclick="exportBudgetPDF()">
                <i class="fas fa-file-pdf"></i> PDF Presupuesto Interno
            </button>
            <button class="btn btn-danger" onclick="clearBudget()">
                <i class="fas fa-trash"></i> Vaciar Presupuesto
            </button>
            <a href="tabiques.html" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Volver a Sistemas
            </a>
        </div>
    </main>

    <script>
        // DATOS COMPLETOS DE TODOS LOS SISTEMAS - 21 TOTALES
        const sistemas = [
            // TABIQUES (7 SISTEMAS)
            {
                id: 'T-45-13', nombre: 'Tabique Ligero 91mm (STD 13mm + Z1 45mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 45mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 45mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-70-13', nombre: 'Tabique Est√°ndar 116mm (STD 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-90-13', nombre: 'Tabique Alto 136mm (STD 13mm + Z1 90mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 90mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 90mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-70-15', nombre: 'Tabique Robusto 120mm (STD 15mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó35', cantidad: '18', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.5', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-AQ-70-13', nombre: 'Tabique H√∫medo AQUA 116mm (AQUA 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            {
                id: 'T-AQ-70-15', nombre: 'Tabique H√∫medo Premium AQUA 120mm (AQUA 15mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa AQUA 15mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '18', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.5', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            {
                id: 'T-EX-70-13', nombre: 'Tabique Exterior Light 96mm (EXTERNA 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.45', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            // TRASDOSADOS (6 SISTEMAS)
            {
                id: 'R-HA-13', nombre: 'Trasdosado HA STD 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-HA-15', nombre: 'Trasdosado HA STD 15mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.35', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-HA-AQ-13', nombre: 'Trasdosado HA AQUA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.4', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-13', nombre: 'Trasdosado Bloque STD 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-AQ-13', nombre: 'Trasdosado Bloque AQUA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.4', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-EX-13', nombre: 'Trasdosado Bloque EXTERNA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.35', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            // TECHOS (5 SISTEMAS)
            {
                id: 'C-TC47-13', nombre: 'Cielo Falso TC 47 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-TC48-13', nombre: 'Cielo Falso TC 48 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 48 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 48', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 48 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-TC47-AQ', nombre: 'Cielo Falso TC 47 + AQUA 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-O17-13', nombre: 'Cielo Bajo Omega 17 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Clip Z1 U201928300A', cantidad: '2.0', unidad: 'ud' }
                ]
            },
            {
                id: 'C-TC47-15', nombre: 'Cielo Falso TC 47 + STD 15mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó35', cantidad: '14', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            // SEMI-INTEMPERIE (3 SISTEMAS)
            {
                id: 'SI-EX-70-13', nombre: 'Semi-Intemperie EXTERNA 116mm (70mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.45', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            {
                id: 'SI-AQ-70-13', nombre: 'Semi-Intemperie AQUA 116mm (70mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.40', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            {
                id: 'SI-EX-90-13', nombre: 'Semi-Intemperie EXTERNA 136mm (90mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 90mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 90mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.50', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            }
        ];

        function renderBudget() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const tbody = document.getElementById('budgetTableBody');
            
            if (budget.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:3rem;">No hay sistemas en el presupuesto. <a href="tabiques.html">A√±ade desde el selector</a></td></tr>';
                document.getElementById('totalM2').textContent = '0';
                document.getElementById('totalSistemas').textContent = '0';
                return;
            }

            let totalM2 = 0;
            tbody.innerHTML = budget.map(item => {
                totalM2 += item.quantity;
                return `
                    <tr>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.id}</td>
                        <td><input type="number" class="qty-input" value="${item.quantity}" onchange="updateQuantity('${item.id}', this.value)"> m¬≤</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="removeFromBudget('${item.id}')">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('totalM2').textContent = totalM2.toLocaleString('es-ES');
            document.getElementById('totalSistemas').textContent = budget.length;
            
            calcularMaterialesTotales();
        }

        function updateQuantity(id, newQty) {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const item = budget.find(i => i.id === id);
            if (item) {
                item.quantity = parseFloat(newQty) || 0;
                localStorage.setItem('fassa_budget', JSON.stringify(budget));
                renderBudget();
            }
        }

        function removeFromBudget(id) {
            if (confirm('¬øEliminar sistema del presupuesto?')) {
                let budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
                budget = budget.filter(i => i.id !== id);
                localStorage.setItem('fassa_budget', JSON.stringify(budget));
                renderBudget();
            }
        }

        function clearBudget() {
            if (confirm('¬øVaciar todo el presupuesto?')) {
                localStorage.removeItem('fassa_budget');
                renderBudget();
            }
        }

        function calcularMaterialesTotales() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const materialesTotales = {};
            
            budget.forEach(item => {
                const sistema = sistemas.find(s => s.id === item.id);
                if (sistema && sistema.materiales) {
                    sistema.materiales.forEach(mat => {
                        const key = `${mat.material}|${mat.unidad}`;
                        if (!materialesTotales[key]) {
                            materialesTotales[key] = { material: mat.material, unidad: mat.unidad, cantidad: 0 };
                        }
                        materialesTotales[key].cantidad += parseFloat(mat.cantidad) * item.quantity;
                    });
                }
            });

            const tbody = document.getElementById('materialsTotalBody');
            tbody.innerHTML = Object.values(materialesTotales)
                .sort((a, b) => b.cantidad - a.cantidad)
                .map(mat => `
                    <tr>
                        <td><strong>${mat.material}</strong></td>
                        <td>${mat.cantidad.toFixed(2)}</td>
                        <td>${mat.unidad}</td>
                    </tr>
                `).join('');

            document.getElementById('materialsBreakdown').style.display = Object.keys(materialesTotales).length > 0 ? 'block' : 'none';
        }

        function exportMaterialsList() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const projectName = document.getElementById('projectName').value || 'proyecto';
            
            let csv = 'FASSABORTOLO CARIBE - LISTA DE MATERIALES\n';
            csv += `Proyecto: ${projectName}\n`;
            csv += 'MATERIAL;CANTIDAD;UNIDAD\n';
            
            const materialesTotales = {};
            budget.forEach(item => {
                const sistema = sistemas.find(s => s.id === item.id);
                if (sistema && sistema.materiales) {
                    sistema.materiales.forEach(mat => {
                        const key = `${mat.material}|${mat.unidad}`;
                        if (!materialesTotales[key]) {
                            materialesTotales[key] = { material: mat.material, unidad: mat.unidad, cantidad: 0 };
                        }
                        materialesTotales[key].cantidad += parseFloat(mat.cantidad) * item.quantity;
                    });
                }
            });

            Object.values(materialesTotales).forEach(mat => {
                csv += `${mat.material};${mat.cantidad.toFixed(2)};${mat.unidad}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `MATERIALES_${projectName.toUpperCase()}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function exportBudgetPDF() {
            alert('Generando PDF interno de presupuesto de materiales... (En producci√≥n real usar√≠a jsPDF)');
        }

        document.addEventListener('DOMContentLoaded', renderBudget);
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Presupuesto Interno - FassaBortolo Caribe</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; line-height: 1.6; }
        .header { background: white; padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
        .logo span { color: #e74c3c; }
        .main-container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .budget-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 15px; margin-bottom: 2rem; }
        .budget-header h1 { font-size: 2.2rem; margin-bottom: 1rem; }
        .project-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .info-card { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; }
        .budget-table { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 1rem; text-align: left; font-weight: 600; color: #2c3e50; border-bottom: 2px solid #dee2e6; }
        td { padding: 1rem; border-bottom: 1px solid #dee2e6; }
        tr:hover { background: #f8f9fa; }
        .system-name { font-weight: 600; color: #2c3e50; }
        .qty-input { width: 80px; padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 4px; text-align: center; }
        .total-row { background: #e74c3c; color: white; font-size: 1.3rem; font-weight: bold; }
        .actions-section { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; }
        .btn { padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; margin: 0.5rem; }
        .btn-success { background: #28a745; color: white; }
        .btn-primary { background: #2c3e50; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn:hover { transform: translateY(-2px); }
        .materials-breakdown { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-top: 1rem; border-left: 4px solid #28a745; }
        .materials-breakdown h3 { color: #2c3e50; margin-bottom: 1rem; }
        @media (max-width: 768px) { .project-info { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <div class="logo">Fassa<span>Bortolo</span> Caribe</div>
            <div style="font-weight:bold; color:#e74c3c;">üõ†Ô∏è MATERIALES POR SISTEMA</div>
        </nav>
    </header>

    <main class="main-container">
        <div class="budget-header">
            <h1><i class="fas fa-calculator"></i> Generador de Presupuesto de Materiales</h1>
            <div class="project-info">
                <div class="info-card">
                    <strong>Proyecto:</strong><br>
                    <input type="text" id="projectName" placeholder="Ej: Larimar Prime T4" style="width:100%; padding:0.5rem; margin-top:0.5rem; border-radius:4px; border:none;">
                </div>
                <div class="info-card">
                    <strong>Total m¬≤:</strong><br>
                    <span id="totalM2" style="font-size:1.5rem;">0</span> m¬≤
                </div>
                <div class="info-card">
                    <strong>Sistemas:</strong><br>
                    <span id="totalSistemas" style="font-size:1.5rem;">0</span> sistemas
                </div>
                <div class="info-card">
                    <strong>Estado:</strong><br>
                    <span style="color:#28a745;">Interno</span>
                </div>
            </div>
        </div>

        <div class="budget-table">
            <table>
                <thead>
                    <tr>
                        <th>Sistema</th>
                        <th>C√≥digo</th>
                        <th>m¬≤ Proyecto</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody id="budgetTableBody"></tbody>
            </table>
        </div>

        <div class="materials-breakdown" id="materialsBreakdown" style="display:none;">
            <h3><i class="fas fa-cogs"></i> Desglose Total de Materiales</h3>
            <table id="materialsTotalTable" style="width:100%; margin-top:1rem;">
                <thead>
                    <tr style="background:#dee2e6;">
                        <th>Material</th>
                        <th>Cantidad Total</th>
                        <th>Unidad</th>
                    </tr>
                </thead>
                <tbody id="materialsTotalBody"></tbody>
            </table>
        </div>

        <div class="actions-section">
            <button class="btn btn-success" onclick="exportMaterialsList()">
                <i class="fas fa-file-excel"></i> Exportar Lista de Materiales (Excel)
            </button>
            <button class="btn btn-primary" onclick="exportBudgetPDF()">
                <i class="fas fa-file-pdf"></i> PDF Presupuesto Interno
            </button>
            <button class="btn btn-danger" onclick="clearBudget()">
                <i class="fas fa-trash"></i> Vaciar Presupuesto
            </button>
            <a href="tabiques.html" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Volver a Sistemas
            </a>
        </div>
    </main>

    <script>
        // DATOS COMPLETOS DE TODOS LOS SISTEMAS - 21 TOTALES
        const sistemas = [
            // TABIQUES (7 SISTEMAS)
            {
                id: 'T-45-13', nombre: 'Tabique Ligero 91mm (STD 13mm + Z1 45mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 45mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 45mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-70-13', nombre: 'Tabique Est√°ndar 116mm (STD 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-90-13', nombre: 'Tabique Alto 136mm (STD 13mm + Z1 90mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 90mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 90mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-70-15', nombre: 'Tabique Robusto 120mm (STD 15mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó35', cantidad: '18', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.5', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-AQ-70-13', nombre: 'Tabique H√∫medo AQUA 116mm (AQUA 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            {
                id: 'T-AQ-70-15', nombre: 'Tabique H√∫medo Premium AQUA 120mm (AQUA 15mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa AQUA 15mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '18', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.5', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            {
                id: 'T-EX-70-13', nombre: 'Tabique Exterior Light 96mm (EXTERNA 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.45', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            // TRASDOSADOS (6 SISTEMAS)
            {
                id: 'R-HA-13', nombre: 'Trasdosado HA STD 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-HA-15', nombre: 'Trasdosado HA STD 15mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.35', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-HA-AQ-13', nombre: 'Trasdosado HA AQUA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.4', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-13', nombre: 'Trasdosado Bloque STD 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-AQ-13', nombre: 'Trasdosado Bloque AQUA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.4', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-EX-13', nombre: 'Trasdosado Bloque EXTERNA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.35', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            // TECHOS (5 SISTEMAS)
            {
                id: 'C-TC47-13', nombre: 'Cielo Falso TC 47 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-TC48-13', nombre: 'Cielo Falso TC 48 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 48 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 48', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 48 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-TC47-AQ', nombre: 'Cielo Falso TC 47 + AQUA 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-O17-13', nombre: 'Cielo Bajo Omega 17 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Clip Z1 U201928300A', cantidad: '2.0', unidad: 'ud' }
                ]
            },
            {
                id: 'C-TC47-15', nombre: 'Cielo Falso TC 47 + STD 15mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó35', cantidad: '14', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            // SEMI-INTEMPERIE (3 SISTEMAS)
            {
                id: 'SI-EX-70-13', nombre: 'Semi-Intemperie EXTERNA 116mm (70mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.45', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            {
                id: 'SI-AQ-70-13', nombre: 'Semi-Intemperie AQUA 116mm (70mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.40', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            {
                id: 'SI-EX-90-13', nombre: 'Semi-Intemperie EXTERNA 136mm (90mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 90mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 90mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.50', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            }
        ];

        function renderBudget() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const tbody = document.getElementById('budgetTableBody');
            
            if (budget.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:3rem;">No hay sistemas en el presupuesto. <a href="tabiques.html">A√±ade desde el selector</a></td></tr>';
                document.getElementById('totalM2').textContent = '0';
                document.getElementById('totalSistemas').textContent = '0';
                return;
            }

            let totalM2 = 0;
            tbody.innerHTML = budget.map(item => {
                totalM2 += item.quantity;
                return `
                    <tr>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.id}</td>
                        <td><input type="number" class="qty-input" value="${item.quantity}" onchange="updateQuantity('${item.id}', this.value)"> m¬≤</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="removeFromBudget('${item.id}')">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('totalM2').textContent = totalM2.toLocaleString('es-ES');
            document.getElementById('totalSistemas').textContent = budget.length;
            
            calcularMaterialesTotales();
        }

        function updateQuantity(id, newQty) {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const item = budget.find(i => i.id === id);
            if (item) {
                item.quantity = parseFloat(newQty) || 0;
                localStorage.setItem('fassa_budget', JSON.stringify(budget));
                renderBudget();
            }
        }

        function removeFromBudget(id) {
            if (confirm('¬øEliminar sistema del presupuesto?')) {
                let budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
                budget = budget.filter(i => i.id !== id);
                localStorage.setItem('fassa_budget', JSON.stringify(budget));
                renderBudget();
            }
        }

        function clearBudget() {
            if (confirm('¬øVaciar todo el presupuesto?')) {
                localStorage.removeItem('fassa_budget');
                renderBudget();
            }
        }

        function calcularMaterialesTotales() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const materialesTotales = {};
            
            budget.forEach(item => {
                const sistema = sistemas.find(s => s.id === item.id);
                if (sistema && sistema.materiales) {
                    sistema.materiales.forEach(mat => {
                        const key = `${mat.material}|${mat.unidad}`;
                        if (!materialesTotales[key]) {
                            materialesTotales[key] = { material: mat.material, unidad: mat.unidad, cantidad: 0 };
                        }
                        materialesTotales[key].cantidad += parseFloat(mat.cantidad) * item.quantity;
                    });
                }
            });

            const tbody = document.getElementById('materialsTotalBody');
            tbody.innerHTML = Object.values(materialesTotales)
                .sort((a, b) => b.cantidad - a.cantidad)
                .map(mat => `
                    <tr>
                        <td><strong>${mat.material}</strong></td>
                        <td>${mat.cantidad.toFixed(2)}</td>
                        <td>${mat.unidad}</td>
                    </tr>
                `).join('');

            document.getElementById('materialsBreakdown').style.display = Object.keys(materialesTotales).length > 0 ? 'block' : 'none';
        }

        function exportMaterialsList() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const projectName = document.getElementById('projectName').value || 'proyecto';
            
            let csv = 'FASSABORTOLO CARIBE - LISTA DE MATERIALES\n';
            csv += `Proyecto: ${projectName}\n`;
            csv += 'MATERIAL;CANTIDAD;UNIDAD\n';
            
            const materialesTotales = {};
            budget.forEach(item => {
                const sistema = sistemas.find(s => s.id === item.id);
                if (sistema && sistema.materiales) {
                    sistema.materiales.forEach(mat => {
                        const key = `${mat.material}|${mat.unidad}`;
                        if (!materialesTotales[key]) {
                            materialesTotales[key] = { material: mat.material, unidad: mat.unidad, cantidad: 0 };
                        }
                        materialesTotales[key].cantidad += parseFloat(mat.cantidad) * item.quantity;
                    });
                }
            });

            Object.values(materialesTotales).forEach(mat => {
                csv += `${mat.material};${mat.cantidad.toFixed(2)};${mat.unidad}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `MATERIALES_${projectName.toUpperCase()}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function exportBudgetPDF() {
            alert('Generando PDF interno de presupuesto de materiales... (En producci√≥n real usar√≠a jsPDF)');
        }

        document.addEventListener('DOMContentLoaded', renderBudget);
    </script>
</body>
</html><!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Presupuesto Interno - FassaBortolo Caribe</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f8f9fa; line-height: 1.6; }
        .header { background: white; padding: 1rem 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: sticky; top: 0; z-index: 1000; }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: bold; color: #2c3e50; }
        .logo span { color: #e74c3c; }
        .main-container { max-width: 1400px; margin: 0 auto; padding: 2rem; }
        .budget-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 15px; margin-bottom: 2rem; }
        .budget-header h1 { font-size: 2.2rem; margin-bottom: 1rem; }
        .project-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .info-card { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 10px; }
        .budget-table { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 20px rgba(0,0,0,0.1); margin-bottom: 2rem; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 1rem; text-align: left; font-weight: 600; color: #2c3e50; border-bottom: 2px solid #dee2e6; }
        td { padding: 1rem; border-bottom: 1px solid #dee2e6; }
        tr:hover { background: #f8f9fa; }
        .system-name { font-weight: 600; color: #2c3e50; }
        .qty-input { width: 80px; padding: 0.5rem; border: 1px solid #dee2e6; border-radius: 4px; text-align: center; }
        .total-row { background: #e74c3c; color: white; font-size: 1.3rem; font-weight: bold; }
        .actions-section { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; }
        .btn { padding: 1rem 2rem; border: none; border-radius: 8px; font-size: 1.1rem; cursor: pointer; transition: all 0.3s; text-decoration: none; display: inline-flex; align-items: center; gap: 0.5rem; margin: 0.5rem; }
        .btn-success { background: #28a745; color: white; }
        .btn-primary { background: #2c3e50; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        .btn:hover { transform: translateY(-2px); }
        .materials-breakdown { background: #f8f9fa; padding: 1.5rem; border-radius: 10px; margin-top: 1rem; border-left: 4px solid #28a745; }
        .materials-breakdown h3 { color: #2c3e50; margin-bottom: 1rem; }
        @media (max-width: 768px) { .project-info { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <header class="header">
        <nav class="nav-container">
            <div class="logo">Fassa<span>Bortolo</span> Caribe</div>
            <div style="font-weight:bold; color:#e74c3c;">üõ†Ô∏è MATERIALES POR SISTEMA</div>
        </nav>
    </header>

    <main class="main-container">
        <div class="budget-header">
            <h1><i class="fas fa-calculator"></i> Generador de Presupuesto de Materiales</h1>
            <div class="project-info">
                <div class="info-card">
                    <strong>Proyecto:</strong><br>
                    <input type="text" id="projectName" placeholder="Ej: Larimar Prime T4" style="width:100%; padding:0.5rem; margin-top:0.5rem; border-radius:4px; border:none;">
                </div>
                <div class="info-card">
                    <strong>Total m¬≤:</strong><br>
                    <span id="totalM2" style="font-size:1.5rem;">0</span> m¬≤
                </div>
                <div class="info-card">
                    <strong>Sistemas:</strong><br>
                    <span id="totalSistemas" style="font-size:1.5rem;">0</span> sistemas
                </div>
                <div class="info-card">
                    <strong>Estado:</strong><br>
                    <span style="color:#28a745;">Interno</span>
                </div>
            </div>
        </div>

        <div class="budget-table">
            <table>
                <thead>
                    <tr>
                        <th>Sistema</th>
                        <th>C√≥digo</th>
                        <th>m¬≤ Proyecto</th>
                        <th>Acci√≥n</th>
                    </tr>
                </thead>
                <tbody id="budgetTableBody"></tbody>
            </table>
        </div>

        <div class="materials-breakdown" id="materialsBreakdown" style="display:none;">
            <h3><i class="fas fa-cogs"></i> Desglose Total de Materiales</h3>
            <table id="materialsTotalTable" style="width:100%; margin-top:1rem;">
                <thead>
                    <tr style="background:#dee2e6;">
                        <th>Material</th>
                        <th>Cantidad Total</th>
                        <th>Unidad</th>
                    </tr>
                </thead>
                <tbody id="materialsTotalBody"></tbody>
            </table>
        </div>

        <div class="actions-section">
            <button class="btn btn-success" onclick="exportMaterialsList()">
                <i class="fas fa-file-excel"></i> Exportar Lista de Materiales (Excel)
            </button>
            <button class="btn btn-primary" onclick="exportBudgetPDF()">
                <i class="fas fa-file-pdf"></i> PDF Presupuesto Interno
            </button>
            <button class="btn btn-danger" onclick="clearBudget()">
                <i class="fas fa-trash"></i> Vaciar Presupuesto
            </button>
            <a href="tabiques.html" class="btn btn-primary">
                <i class="fas fa-arrow-left"></i> Volver a Sistemas
            </a>
        </div>
    </main>

    <script>
        // DATOS COMPLETOS DE TODOS LOS SISTEMAS - 21 TOTALES
        const sistemas = [
            // TABIQUES (7 SISTEMAS)
            {
                id: 'T-45-13', nombre: 'Tabique Ligero 91mm (STD 13mm + Z1 45mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 45mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 45mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-70-13', nombre: 'Tabique Est√°ndar 116mm (STD 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-90-13', nombre: 'Tabique Alto 136mm (STD 13mm + Z1 90mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 90mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 90mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-70-15', nombre: 'Tabique Robusto 120mm (STD 15mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó35', cantidad: '18', unidad: 'ud' },
                    { material: 'Tornillo metal-metal 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.5', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' }
                ]
            },
            {
                id: 'T-AQ-70-13', nombre: 'Tabique H√∫medo AQUA 116mm (AQUA 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó25', cantidad: '24', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.4', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            {
                id: 'T-AQ-70-15', nombre: 'Tabique H√∫medo Premium AQUA 120mm (AQUA 15mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa AQUA 15mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '18', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.5', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            {
                id: 'T-EX-70-13', nombre: 'Tabique Exterior Light 96mm (EXTERNA 13mm + Z1 70mm)', categoria: 'tabiques',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.45', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            // TRASDOSADOS (6 SISTEMAS)
            {
                id: 'R-HA-13', nombre: 'Trasdosado HA STD 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-HA-15', nombre: 'Trasdosado HA STD 15mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.35', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-HA-AQ-13', nombre: 'Trasdosado HA AQUA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje universal Omega M6', cantidad: '10', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.4', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-13', nombre: 'Trasdosado Bloque STD 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-AQ-13', nombre: 'Trasdosado Bloque AQUA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.30', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 50mm', cantidad: '0.4', unidad: 'ml' }
                ]
            },
            {
                id: 'R-BL-EX-13', nombre: 'Trasdosado Bloque EXTERNA 13mm (Omega 17)', categoria: 'trasdosados',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '1.00', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '12', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.35', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '0.8', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.5', unidad: 'ml' }
                ]
            },
            // TECHOS (5 SISTEMAS)
            {
                id: 'C-TC47-13', nombre: 'Cielo Falso TC 47 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-TC48-13', nombre: 'Cielo Falso TC 48 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 48 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 48', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 48 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-TC47-AQ', nombre: 'Cielo Falso TC 47 + AQUA 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            {
                id: 'C-O17-13', nombre: 'Cielo Bajo Omega 17 + STD 13mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 13mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'Omega 17 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó25', cantidad: '16', unidad: 'ud' },
                    { material: 'Anclaje directo (304029)', cantidad: '8', unidad: 'ud' },
                    { material: 'Clip Z1 U201928300A', cantidad: '2.0', unidad: 'ud' }
                ]
            },
            {
                id: 'C-TC47-15', nombre: 'Cielo Falso TC 47 + STD 15mm', categoria: 'techos',
                materiales: [
                    { material: 'Placa STD BA 15mm', cantidad: '1.10', unidad: 'm¬≤' },
                    { material: 'TC 47 Z1', cantidad: '2.00', unidad: 'ml' },
                    { material: 'Omega 17 Z1', cantidad: '0.50', unidad: 'ml' },
                    { material: 'Tornillo placa-metal 3.5√ó35', cantidad: '14', unidad: 'ud' },
                    { material: 'Horquilla cuelgue TC 47', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Suspensi√≥n TC 47 (180mm)', cantidad: '2.5', unidad: 'ud' },
                    { material: 'Varilla roscada √ò6√ó1000', cantidad: '0.30', unidad: 'm' }
                ]
            },
            // SEMI-INTEMPERIE (3 SISTEMAS)
            {
                id: 'SI-EX-70-13', nombre: 'Semi-Intemperie EXTERNA 116mm (70mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.45', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            {
                id: 'SI-AQ-70-13', nombre: 'Semi-Intemperie AQUA 116mm (70mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa AQUA 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 70mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 70mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSAJOINT 1H', cantidad: '0.40', unidad: 'kg' },
                    { material: 'Cinta papel', cantidad: '1.2', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            },
            {
                id: 'SI-EX-90-13', nombre: 'Semi-Intemperie EXTERNA 136mm (90mm)', categoria: 'semi-intemperie',
                materiales: [
                    { material: 'Placa EXTERNA Light 13mm', cantidad: '2.00', unidad: 'm¬≤' },
                    { material: 'Montante Z1 90mm', cantidad: '2.50', unidad: 'ml' },
                    { material: 'Canal Z1 90mm', cantidad: '0.70', unidad: 'ml' },
                    { material: 'Tornillo Inox 3.5√ó35', cantidad: '20', unidad: 'ud' },
                    { material: 'Tornillo Inox 3.5√ó9.5', cantidad: '30', unidad: 'ud' },
                    { material: 'FASSA A 64', cantidad: '0.50', unidad: 'kg' },
                    { material: 'Malla fibra vidrio 100mm', cantidad: '1.0', unidad: 'ml' },
                    { material: 'Banda estanca 70mm', cantidad: '0.6', unidad: 'ml' }
                ]
            }
        ];

        function renderBudget() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const tbody = document.getElementById('budgetTableBody');
            
            if (budget.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; padding:3rem;">No hay sistemas en el presupuesto. <a href="tabiques.html">A√±ade desde el selector</a></td></tr>';
                document.getElementById('totalM2').textContent = '0';
                document.getElementById('totalSistemas').textContent = '0';
                return;
            }

            let totalM2 = 0;
            tbody.innerHTML = budget.map(item => {
                totalM2 += item.quantity;
                return `
                    <tr>
                        <td><strong>${item.name}</strong></td>
                        <td>${item.id}</td>
                        <td><input type="number" class="qty-input" value="${item.quantity}" onchange="updateQuantity('${item.id}', this.value)"> m¬≤</td>
                        <td>
                            <button class="btn btn-danger btn-small" onclick="removeFromBudget('${item.id}')">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('totalM2').textContent = totalM2.toLocaleString('es-ES');
            document.getElementById('totalSistemas').textContent = budget.length;
            
            calcularMaterialesTotales();
        }

        function updateQuantity(id, newQty) {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const item = budget.find(i => i.id === id);
            if (item) {
                item.quantity = parseFloat(newQty) || 0;
                localStorage.setItem('fassa_budget', JSON.stringify(budget));
                renderBudget();
            }
        }

        function removeFromBudget(id) {
            if (confirm('¬øEliminar sistema del presupuesto?')) {
                let budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
                budget = budget.filter(i => i.id !== id);
                localStorage.setItem('fassa_budget', JSON.stringify(budget));
                renderBudget();
            }
        }

        function clearBudget() {
            if (confirm('¬øVaciar todo el presupuesto?')) {
                localStorage.removeItem('fassa_budget');
                renderBudget();
            }
        }

        function calcularMaterialesTotales() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const materialesTotales = {};
            
            budget.forEach(item => {
                const sistema = sistemas.find(s => s.id === item.id);
                if (sistema && sistema.materiales) {
                    sistema.materiales.forEach(mat => {
                        const key = `${mat.material}|${mat.unidad}`;
                        if (!materialesTotales[key]) {
                            materialesTotales[key] = { material: mat.material, unidad: mat.unidad, cantidad: 0 };
                        }
                        materialesTotales[key].cantidad += parseFloat(mat.cantidad) * item.quantity;
                    });
                }
            });

            const tbody = document.getElementById('materialsTotalBody');
            tbody.innerHTML = Object.values(materialesTotales)
                .sort((a, b) => b.cantidad - a.cantidad)
                .map(mat => `
                    <tr>
                        <td><strong>${mat.material}</strong></td>
                        <td>${mat.cantidad.toFixed(2)}</td>
                        <td>${mat.unidad}</td>
                    </tr>
                `).join('');

            document.getElementById('materialsBreakdown').style.display = Object.keys(materialesTotales).length > 0 ? 'block' : 'none';
        }

        function exportMaterialsList() {
            const budget = JSON.parse(localStorage.getItem('fassa_budget') || '[]');
            const projectName = document.getElementById('projectName').value || 'proyecto';
            
            let csv = 'FASSABORTOLO CARIBE - LISTA DE MATERIALES\n';
            csv += `Proyecto: ${projectName}\n`;
            csv += 'MATERIAL;CANTIDAD;UNIDAD\n';
            
            const materialesTotales = {};
            budget.forEach(item => {
                const sistema = sistemas.find(s => s.id === item.id);
                if (sistema && sistema.materiales) {
                    sistema.materiales.forEach(mat => {
                        const key = `${mat.material}|${mat.unidad}`;
                        if (!materialesTotales[key]) {
                            materialesTotales[key] = { material: mat.material, unidad: mat.unidad, cantidad: 0 };
                        }
                        materialesTotales[key].cantidad += parseFloat(mat.cantidad) * item.quantity;
                    });
                }
            });

            Object.values(materialesTotales).forEach(mat => {
                csv += `${mat.material};${mat.cantidad.toFixed(2)};${mat.unidad}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `MATERIALES_${projectName.toUpperCase()}_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function exportBudgetPDF() {
            alert('Generando PDF interno de presupuesto de materiales... (En producci√≥n real usar√≠a jsPDF)');
        }

        document.addEventListener('DOMContentLoaded', renderBudget);
    </script>
</body>
</html>